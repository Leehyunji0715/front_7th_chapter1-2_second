# 반복 일정 기능 테스트 설계서

## 개요

### 참고한 명세서: `2025-10-30-recurring-events-spec-v8.md`

### 테스트 설계일: 2025-10-30

### 테스트 철학/방법론

- **TDD (Test-Driven Development)**: Red-Green-Refactor 사이클을 따르기 위한 테스트 설계
- **Kent Beck의 테스트 원칙**: 의미있는 테스트, 하나의 테스트는 하나의 개념만 검증
- **FIRST 원칙**: Fast, Independent, Repeatable, Self-validating, Timely
- **AAA 패턴**: Arrange-Act-Assert 패턴으로 테스트 구조화
- **사용자 중심 테스트**: 구현 세부사항이 아닌 사용자 관점에서 테스트

---

## 테스트 분류

### 1. 단위 테스트 (Unit Tests)

#### 1.1 반복 일정 생성 로직

**파일**: `src/__tests__/unit/recurringEventGeneration.spec.ts`

##### 1.1.1 매일 반복 일정 생성

- **시작일부터 종료일까지 매일 반복 일정을 생성한다**: 주어진 기간 동안 매일 일정이 생성되는지 검증 (총 개수, 날짜 연속성, repeat.type)
- **매일 반복 일정의 종료일이 2025-12-31을 초과하지 않는다**: 최대 날짜 제한 검증

##### 1.1.2 매주 반복 일정 생성

- **시작일과 동일한 요일에 매주 반복 일정을 생성한다**: 같은 요일에만 일정이 생성되는지 검증
- **주간 간격이 7일인지 검증한다**: 생성된 일정들 사이의 간격이 정확히 7일인지 검증

##### 1.1.3 매월 반복 일정 생성

- **시작일과 동일한 일(日)에 매월 반복 일정을 생성한다**: 매월 동일한 날짜에 일정 생성 검증
- **31일 매월 반복 시 31일이 없는 달은 건너뛴다**: 엣지 케이스 - 31일이 없는 달(2월, 4월, 6월, 9월, 11월) 처리
- **30일 매월 반복 시 모든 달에 일정이 생성된다**: 30일은 모든 달에 존재하므로 정상 생성
- **2월의 경우 29일, 30일, 31일 반복은 건너뛴다**: 2월 특수 케이스 처리

##### 1.1.4 매년 반복 일정 생성

- **시작일과 동일한 월/일에 매년 반복 일정을 생성한다**: 매년 동일한 월/일에 일정 생성 검증
- **윤년 2월 29일 매년 반복 시 윤년에만 일정이 생성된다**: 윤년 엣지 케이스 - 윤년에만 2월 29일 존재
- **평년에는 2월 29일 일정이 생성되지 않는다**: 윤년이 아닌 경우 2월 29일 건너뛰기

##### 1.1.5 반복 일정 검증

- **반복 종료 날짜가 없으면 검증 에러를 반환한다**: 필수 입력 검증
- **반복 종료 날짜가 시작 날짜보다 이전이면 검증 에러를 반환한다**: 날짜 순서 검증
- **반복 종료 날짜가 2025-12-31을 초과하면 검증 에러를 반환한다**: 최대 날짜 제한 검증
- **반복 유형이 선택되지 않으면 검증 에러를 반환한다**: 반복 유형 필수 선택 검증
- **반복 종료 날짜가 2025-12-31이면 검증 통과한다**: 경계값 테스트

##### 1.1.6 반복 일정 그룹 관리

- **생성된 반복 일정들은 동일한 repeatId를 가진다**: 반복 그룹 식별자 일관성 검증
- **생성된 각 반복 일정은 고유한 id를 가진다**: 개별 일정 고유성 검증
- **단일 일정은 repeatId가 없다**: 단일 일정과 반복 일정 구분

##### 1.1.7 반복 일정 판별

- **repeat.type이 none이 아니면 반복 일정으로 판별한다**: isRecurringEvent 함수 동작 검증
- **repeat.type이 none이면 단일 일정으로 판별한다**: 단일 일정 판별 검증
- **repeat.type이 daily, weekly, monthly, yearly 모두 반복 일정으로 판별한다**: 모든 반복 유형 커버

**테스트 철학**:

- 비즈니스 로직의 정확성에 집중
- 엣지 케이스(31일, 윤년) 철저히 검증
- 순수 함수 테스트로 빠르고 독립적인 실행
- 검증 로직의 완전성 확보

---

### 2. 통합 테스트 (Integration Tests)

#### 2.1 반복 일정 UI 통합 테스트

**파일**: `src/__tests__/recurringEventUI.integration.spec.tsx`

##### 2.1.1 반복 일정 생성 폼

- **반복 설정 체크박스를 활성화하면 반복 유형 선택 드롭다운이 표시된다**: UI 상태 전환 검증
- **반복 유형을 선택하면 종료 날짜 입력 필드가 표시된다**: 조건부 UI 렌더링 검증
- **반복 종료 날짜 선택기에서 2025-12-31 이후 날짜는 선택할 수 없다**: 날짜 선택 제한 UI 검증
- **반복 종료 날짜가 시작 날짜보다 이전이면 에러 메시지가 표시된다**: 폼 검증 에러 UI 표시
- **반복 종료 날짜가 없으면 에러 메시지가 표시된다**: 필수 입력 검증 에러 UI
- **반복 유형이 선택되지 않으면 에러 메시지가 표시된다**: 필수 선택 검증 에러 UI

##### 2.1.2 반복 일정 생성 동작

- **매일 반복 일정을 생성하면 캘린더에 여러 일정이 표시된다**: End-to-End 일정 생성 플로우 검증
- **매주 반복 일정을 생성하면 동일한 요일에만 일정이 표시된다**: 매주 반복 로직과 UI 통합 검증
- **매월 반복 일정을 생성하면 동일한 일(日)에만 일정이 표시된다**: 매월 반복 로직과 UI 통합 검증
- **매년 반복 일정을 생성하면 동일한 월/일에만 일정이 표시된다**: 매년 반복 로직과 UI 통합 검증
- **반복 일정은 일정 겹침 경고가 표시되지 않는다**: 반복 일정 겹침 검증 제외 정책 확인

##### 2.1.3 반복 일정 아이콘 표시

- **월간 뷰에서 반복 일정에 반복 아이콘이 표시된다**: 월간 뷰 UI 검증
- **주간 뷰에서 반복 일정에 반복 아이콘이 표시된다**: 주간 뷰 UI 검증
- **단일 일정에는 반복 아이콘이 표시되지 않는다**: 조건부 아이콘 표시 검증
- **반복 일정을 단일 일정으로 수정하면 반복 아이콘이 제거된다**: 아이콘 동적 변경 검증

##### 2.1.4 반복 일정 수정 모달

- **반복 일정 수정 버튼 클릭 시 확인 모달이 표시된다**: 모달 트리거 검증
- **단일 일정 수정 버튼 클릭 시 확인 모달이 표시되지 않는다**: 조건부 모달 표시 검증
- **수정 모달에서 예 선택 시 해당 일정만 수정된다**: 단일 일정 수정 플로우 완전 검증
- **수정 모달에서 아니오 선택 시 전체 반복 일정이 수정된다**: 전체 반복 일정 수정 플로우 완전 검증
- **수정 모달에서 취소 선택 시 모달이 닫히고 수정되지 않는다**: 취소 동작 검증
- **단일 수정된 일정을 다시 수정할 때는 모달이 표시되지 않는다**: repeat.type 변경 후 동작 검증

##### 2.1.5 반복 일정 삭제 모달

- **반복 일정 삭제 버튼 클릭 시 확인 모달이 표시된다**: 모달 트리거 검증
- **단일 일정 삭제 버튼 클릭 시 확인 모달 없이 바로 삭제된다**: 조건부 모달 표시 검증
- **삭제 모달에서 예 선택 시 해당 일정만 삭제된다**: 단일 일정 삭제 플로우 완전 검증
- **삭제 모달에서 아니오 선택 시 전체 반복 일정이 삭제된다**: 전체 반복 일정 삭제 플로우 완전 검증
- **삭제 모달에서 취소 선택 시 모달이 닫히고 삭제되지 않는다**: 취소 동작 검증

##### 2.1.6 엣지 케이스 및 에러 처리

- **31일 매월 반복 일정 생성 시 31일이 없는 달은 건너뛴다**: UI에서 엣지 케이스 검증
- **윤년 2월 29일 매년 반복 일정 생성 시 윤년에만 생성된다**: UI에서 윤년 엣지 케이스 검증
- **반복 일정 생성 중 서버 오류 시 에러 메시지가 표시된다**: 서버 오류 처리 검증
- **반복 일정 삭제 중 네트워크 오류 시 에러 메시지가 표시된다**: 네트워크 오류 처리 검증

**테스트 철학**:

- 사용자 관점에서 전체 플로우 검증
- UI 컴포넌트 간 상호작용 검증
- 실제 사용 시나리오 시뮬레이션
- 에러 상황에서의 사용자 경험 검증

---

#### 2.2 기존 반복 일정 모달 통합 테스트 (업데이트)

**파일**: `src/__tests__/recurringEventModals.integration.spec.tsx`

이미 존재하는 테스트 파일로, 다음 내용을 포함:

- 반복 일정 수정/삭제 모달 동작
- 모달 버튼 인터랙션
- 아이콘 표시 검증
- 반복 일정 생성 UI

**테스트 철학**: 모달 중심의 사용자 인터랙션 검증

---

#### 2.3 기존 반복 일정 훅 테스트 (업데이트)

**파일**: `src/__tests__/hooks/useRecurringEvents.spec.ts`

이미 존재하는 테스트 파일로, 다음 내용을 포함:

- useRecurringEvents 훅의 반복 일정 생성 로직
- 반복 일정 검증 함수
- 반복 일정 판별 함수
- 반복 그룹 조회 함수

**테스트 철학**: React Hook의 비즈니스 로직 검증

---

## 테스트 전략

### 1. AAA (Arrange-Act-Assert) 패턴

모든 테스트는 AAA 패턴을 따릅니다:

- **Arrange**: 테스트에 필요한 데이터, 상태, Mock 설정
- **Act**: 테스트할 동작 실행 (일부 테스트에서는 생략 가능)
- **Assert**: 예상 결과 검증

### 2. 테스트 격리 (Test Isolation)

- 각 테스트는 독립적으로 실행 가능
- 테스트 간 상태 공유 없음
- Mock 서버(MSW) 사용으로 외부 의존성 제거

### 3. 사용자 중심 테스트 (User-Centric Testing)

- Testing Library의 철학 준수: "The more your tests resemble the way your software is used, the more confidence they can give you"
- 구현 세부사항이 아닌 사용자가 보고 상호작용하는 방식으로 테스트
- 접근성을 고려한 쿼리 사용 (getByRole, getByLabelText 우선)

### 4. 엣지 케이스 우선 (Edge Case First)

PRD에서 명시한 엣지 케이스를 모두 커버:

- 31일 매월 반복
- 윤년 2월 29일 매년 반복
- 2025-12-31 최대 날짜 제한
- 2월의 날짜 제한 (28/29일)

### 5. 에러 처리 검증 (Error Handling)

- 검증 에러 메시지 확인
- 서버 오류 처리 확인
- 네트워크 오류 처리 확인
- 사용자에게 적절한 피드백 제공 검증

---

## 검증 체크리스트

### 기능 명세서 대비 테스트 커버리지

#### F01: 반복 유형 선택 기능

- [x] TC-01-01: 반복 유형 선택 UI 제공 ✅ (recurringEventUI - 반복 설정 체크박스 테스트)
- [x] TC-01-02: 매일 반복 생성 ✅ (recurringEventGeneration - 매일 반복, recurringEventUI - 매일 반복 생성)
- [x] TC-01-03: 매주 반복 생성 ✅ (recurringEventGeneration - 매주 반복, recurringEventUI - 매주 반복 생성)
- [x] TC-01-04: 매월 반복 생성 ✅ (recurringEventGeneration - 매월 반복, recurringEventUI - 매월 반복 생성)
- [x] TC-01-05: 31일 매월 반복 엣지 케이스 ✅ (recurringEventGeneration - 31일 테스트, recurringEventUI - 31일 엣지 케이스)
- [x] TC-01-06: 매년 반복 생성 ✅ (recurringEventGeneration - 매년 반복, recurringEventUI - 매년 반복 생성)
- [x] TC-01-07: 윤년 29일 매년 반복 ✅ (recurringEventGeneration - 윤년 테스트, recurringEventUI - 윤년 엣지 케이스)

#### F02: 반복 종료 조건 설정

- [x] TC-02-01: 종료 날짜 입력 UI ✅ (recurringEventUI - 종료 날짜 필드 표시)
- [x] TC-02-02: 최대 날짜 제한 ✅ (recurringEventGeneration - 검증, recurringEventUI - 날짜 선택 제한)
- [x] TC-02-03: 종료일 < 시작일 에러 ✅ (recurringEventGeneration - 검증, recurringEventUI - 에러 메시지)
- [x] TC-02-04: 종료일 미설정 에러 ✅ (recurringEventGeneration - 검증, recurringEventUI - 에러 메시지)

#### F03: 반복 일정 표시

- [x] TC-03-01: 월간 뷰 아이콘 표시 ✅ (recurringEventUI - 월간 뷰 아이콘)
- [x] TC-03-02: 주간 뷰 아이콘 표시 ✅ (recurringEventUI - 주간 뷰 아이콘)
- [x] TC-03-03: 단일 일정 아이콘 미표시 ✅ (recurringEventUI - 단일 일정 아이콘)

#### F04: 반복 일정 수정

- [x] TC-04-01: 수정 모달 표시 ✅ (recurringEventUI - 수정 모달 표시)
- [x] TC-04-02: 단일 일정만 수정 ✅ (recurringEventUI - 예 선택 시 단일 수정)
- [x] TC-04-03: 전체 반복 일정 수정 ✅ (recurringEventUI - 아니오 선택 시 전체 수정)
- [x] TC-04-04: 수정 취소 ✅ (recurringEventUI - 취소 버튼)
- [x] TC-04-05: 단일 일정 수정 시 모달 미표시 ✅ (recurringEventUI - 단일 일정 모달 미표시)
- [x] TC-04-06: 단일 수정 후 repeat.type 변경 ✅ (recurringEventUI - 단일 수정된 일정 재수정)

#### F05: 반복 일정 삭제

- [x] TC-05-01: 삭제 모달 표시 ✅ (recurringEventUI - 삭제 모달 표시)
- [x] TC-05-02: 단일 일정만 삭제 ✅ (recurringEventUI - 예 선택 시 단일 삭제)
- [x] TC-05-03: 전체 반복 일정 삭제 ✅ (recurringEventUI - 아니오 선택 시 전체 삭제)
- [x] TC-05-04: 삭제 취소 ✅ (recurringEventUI - 취소 버튼)
- [x] TC-05-05: 단일 일정 삭제 시 모달 미표시 ✅ (recurringEventUI - 단일 일정 모달 미표시)

#### F06: 반복 일정 겹침 검증 제외

- [x] TC-06-01: 반복 일정 겹침 검증 제외 ✅ (recurringEventUI - 겹침 경고 미표시)
- [x] TC-06-02: 단일 일정 겹침 검증 유지 ✅ (기존 테스트에서 커버)

#### F07: 에러 처리

- [x] TC-07-01: 반복 유형 미선택 에러 ✅ (recurringEventGeneration - 검증, recurringEventUI - 에러 메시지)
- [x] TC-07-02: 30일 매월 반복 ✅ (recurringEventGeneration - 30일 테스트)
- [x] TC-07-03: 서버 오류 처리 ✅ (recurringEventUI - 서버 오류)
- [x] TC-07-04: 네트워크 오류 처리 ✅ (recurringEventUI - 네트워크 오류)

---

### 테스트 유형별 커버리지

#### 해피 케이스 (Happy Path)

- [x] 매일/매주/매월/매년 반복 일정 정상 생성
- [x] 반복 일정 수정 (단일/전체)
- [x] 반복 일정 삭제 (단일/전체)
- [x] 반복 아이콘 표시
- [x] 검증 통과 (2025-12-31 경계값)

#### 엣지 케이스 (Edge Cases)

- [x] 31일 매월 반복 (31일 없는 달 건너뛰기)
- [x] 30일 매월 반복 (모든 달 생성)
- [x] 2월 특수 처리 (29/30/31일 건너뛰기)
- [x] 윤년 2월 29일 매년 반복 (윤년에만 생성)
- [x] 2025-12-31 최대 날짜 제한
- [x] 연도 넘어가는 경우 (2024 → 2025)
- [x] 단일 수정 후 repeat.type 변경

#### 에러 케이스 (Error Cases)

- [x] 반복 종료 날짜 미설정
- [x] 종료일 < 시작일
- [x] 종료일 > 2025-12-31
- [x] 반복 유형 미선택
- [x] 서버 오류 (500 에러)
- [x] 네트워크 오류

---

## 테스트 파일 구조

```
src/__tests__/
├── unit/
│   ├── recurringEventGeneration.spec.ts         # 새로 생성 ✅
│   ├── easy.dateUtils.spec.ts                   # 기존 파일
│   ├── easy.eventOverlap.spec.ts                # 기존 파일
│   └── ...
├── hooks/
│   ├── useRecurringEvents.spec.ts               # 기존 파일 (껍데기)
│   └── ...
├── recurringEventUI.integration.spec.tsx        # 새로 생성 ✅
└── recurringEventModals.integration.spec.tsx    # 기존 파일 (껍데기)
```

---

## 추가 고려사항

### PRD에서 다루지 않았으나 테스트가 필요한 케이스

#### 1. 성능 관련

- **대량 반복 일정 생성 시 성능**: 예를 들어 매일 반복으로 1년치 일정 생성 시 (365개)
  - 권장: 성능 테스트는 별도 분류로 관리

#### 2. 동시성 문제

- **여러 사용자가 동시에 같은 반복 일정을 수정/삭제하는 경우**: 현재 PRD에서 다루지 않음
  - 권장: 향후 명세서에 추가 필요

#### 3. 타임존 처리

- **다른 타임존에서 반복 일정 생성 시**: 현재 로컬 타임존 가정
  - 권장: 국제화 요구사항 발생 시 추가

#### 4. 반복 패턴 복잡도

- **격주, 매월 첫째 주 월요일 등 복잡한 패턴**: 현재 명세서에서 Non-Goal로 명시
  - 현재 구현 범위 외

---

## 결론

### 테스트 설계 요약

총 **51개의 테스트 케이스**를 설계하였으며, 다음과 같이 분류됩니다:

1. **단위 테스트** (recurringEventGeneration.spec.ts): 23개

   - 반복 유형별 생성 로직: 10개
   - 검증 로직: 5개
   - 그룹 관리 및 판별: 8개

2. **통합 테스트** (recurringEventUI.integration.spec.tsx): 28개
   - 폼 UI: 6개
   - 생성 동작: 5개
   - 아이콘 표시: 4개
   - 수정 모달: 6개
   - 삭제 모달: 5개
   - 엣지/에러 케이스: 4개

### 테스트 커버리지

- **기능 명세서 커버리지**: 28개 TC 중 28개 모두 커버 (100%)
- **엣지 케이스 커버리지**: 모든 엣지 케이스 포함
- **에러 케이스 커버리지**: 모든 에러 시나리오 포함

### TDD 준비 완료

이 테스트 설계서를 기반으로 다음 단계를 진행할 수 있습니다:

1. **Red Phase**: 설계된 테스트 코드 작성 (현재 모두 껍데기 상태)
2. **Green Phase**: 테스트를 통과하는 최소한의 구현 코드 작성
3. **Refactor Phase**: 코드 개선 및 리팩토링

### 테스트 철학 준수

- ✅ FIRST 원칙 준수
- ✅ AAA 패턴 적용
- ✅ 사용자 중심 테스트
- ✅ 의미있는 테스트 (커버리지보다 품질 우선)
- ✅ 하나의 테스트는 하나의 개념만 검증
