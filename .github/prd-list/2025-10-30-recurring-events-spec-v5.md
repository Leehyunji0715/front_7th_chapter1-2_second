# 반복 일정 기능 명세서 v5

## 1. 요약 (Summary)

캘린더 일정 관리 애플리케이션에서 사용자가 반복 일정을 생성, 수정, 삭제할 수 있는 기능을 구현합니다. 매일/매주/매월/매년 단위로 반복되는 일정을 특정 날짜까지 자동 생성하며, 반복 일정을 아이콘으로 시각적으로 구분하고, 모달 확인 절차를 통해 개별 일정 또는 전체 반복 일정을 선택적으로 수정/삭제할 수 있습니다.

## 2. 배경 (Background)

현재 애플리케이션은 단일 일정만 관리할 수 있어, 매주 반복되는 회의나 매달 반복되는 이벤트를 일일이 수동으로 입력해야 하는 불편함이 있습니다. 사용자들은 정기적으로 발생하는 일정을 효율적으로 관리하고, 필요에 따라 특정 날짜의 반복 일정만 수정하거나 전체 시리즈를 한 번에 수정/삭제할 수 있는 기능을 필요로 합니다.

이 기능은 사용자의 일정 입력 시간을 크게 단축시키고, 반복적인 작업의 오류를 줄이며, 더 나은 일정 관리 경험을 제공합니다.

## 3. 목표 (Goals)

- 일정 생성 및 수정 시 반복 유형(매일, 매주, 매월, 매년)을 선택할 수 있다.
- 반복 일정이 지정된 종료일(최대 2025-12-31)까지 자동으로 생성된다.
- 캘린더 뷰에서 반복 일정을 아이콘(🔁)으로 구분하여 표시한다.
- 반복 일정 수정 시 '해당 일정만 수정하시겠어요?' 모달로 수정 범위를 선택할 수 있다.
- 반복 일정 삭제 시 '해당 일정만 삭제하시겠어요?' 모달로 삭제 범위를 선택할 수 있다.
- 월의 특정 날짜(예: 31일)에 매월 반복 설정 시 해당 날짜가 존재하는 달에만 일정이 생성된다.
- 윤년의 특정 날짜(2월 29일)에 매년 반복 설정 시 해당 날짜가 존재하는 해에만 일정이 생성된다.
- 반복 일정은 일정 겹침 검사를 수행하지 않는다.

## 4. 목표가 아닌 것 (Non-Goals)

- 반복 일정에 대한 겹침 검사는 수행하지 않는다.
- 복잡한 반복 패턴 (예: 매월 첫째 주 월요일, 평일만 등)은 지원하지 않는다.
- 반복 종료 조건으로 '횟수 지정' 옵션은 제공하지 않는다.
- 반복 일정의 예외 처리 (특정 날짜만 건너뛰기)는 지원하지 않는다.
- 서버 API를 통한 반복 일정 동기화는 구현하지 않는다.

## 5. 계획 (Plan)

### **[F01] 반복 유형 선택 기능**

일정 생성 또는 수정 시 사용자가 반복 유형을 선택할 수 있는 UI를 제공합니다.

- **사용자 시나리오 (User Story)**: 사용자가 일정을 생성하거나 수정할 때 반복 유형(매일, 매주, 매월, 매년)을 선택할 수 있다.

- **인수 기준 (Acceptance Criteria):**
  - **AC-F01-01: 반복 유형 선택 UI 표시**
    - **Arrange**: 사용자가 일정 추가/수정 모달을 연다.
    - **Act**: 사용자가 반복 유형 드롭다운을 클릭한다.
    - **Assert**: 드롭다운에서 '매일', '매주', '매월', '매년' 옵션이 표시된다.
  
  - **AC-F01-02: 매일 반복 선택**
    - **Arrange**: 일정 추가/수정 모달이 열려 있다.
    - **Act**: 사용자가 반복 유형으로 '매일'을 선택한다.
    - **Assert**: `repeat.type`이 'daily'로 설정된다.
  
  - **AC-F01-03: 매주 반복 선택**
    - **Arrange**: 일정 추가/수정 모달이 열려 있다.
    - **Act**: 사용자가 반복 유형으로 '매주'를 선택한다.
    - **Assert**: `repeat.type`이 'weekly'로 설정된다.
  
  - **AC-F01-04: 매월 반복 선택**
    - **Arrange**: 일정 추가/수정 모달이 열려 있다.
    - **Act**: 사용자가 반복 유형으로 '매월'을 선택한다.
    - **Assert**: `repeat.type`이 'monthly'로 설정된다.
  
  - **AC-F01-05: 매년 반복 선택**
    - **Arrange**: 일정 추가/수정 모달이 열려 있다.
    - **Act**: 사용자가 반복 유형으로 '매년'을 선택한다.
    - **Assert**: `repeat.type`이 'yearly'로 설정된다.

### **[F02] 반복 종료 조건 설정**

반복 일정의 종료 날짜를 지정할 수 있는 기능을 제공합니다.

- **사용자 시나리오 (User Story)**: 사용자가 반복 일정의 종료 날짜를 지정할 수 있으며, 최대 2025-12-31까지 설정할 수 있다.

- **인수 기준 (Acceptance Criteria):**
  - **AC-F02-01: 반복 종료일 입력 필드 표시**
    - **Arrange**: 사용자가 반복 유형을 선택한다.
    - **Act**: 반복 종료일 입력 필드를 확인한다.
    - **Assert**: 날짜 선택 필드가 활성화되어 있다.
  
  - **AC-F02-02: 종료일 최대값 제한**
    - **Arrange**: 사용자가 반복 종료일 필드를 클릭한다.
    - **Act**: 사용자가 2025-12-31 이후의 날짜를 선택하려고 한다.
    - **Assert**: 2025-12-31까지만 선택 가능하며, 그 이후 날짜는 선택할 수 없다.
  
  - **AC-F02-03: 종료일이 시작일보다 이전인 경우 검증**
    - **Arrange**: 사용자가 일정 시작일을 2025-11-01로 설정한다.
    - **Act**: 사용자가 반복 종료일을 2025-10-31로 설정하고 저장을 시도한다.
    - **Assert**: '종료일은 시작일 이후여야 합니다.'라는 검증 메시지가 표시되고 저장이 실행되지 않는다.

### **[F03] 반복 일정 자동 생성**

선택한 반복 유형과 종료일에 따라 반복 일정을 자동으로 생성합니다.

- **사용자 시나리오 (User Story)**: 사용자가 반복 설정을 지정하면 시스템이 종료일까지 자동으로 반복 일정을 생성한다.

- **인수 기준 (Acceptance Criteria):**
  - **AC-F03-01: 매일 반복 일정 생성**
    - **Arrange**: 사용자가 2025-11-01 일정을 '매일' 반복, 종료일 2025-11-05로 설정한다.
    - **Act**: 사용자가 일정을 저장한다.
    - **Assert**: 2025-11-01, 11-02, 11-03, 11-04, 11-05 총 5개의 일정이 생성된다.
  
  - **AC-F03-02: 매주 반복 일정 생성**
    - **Arrange**: 사용자가 2025-11-03(월요일) 일정을 '매주' 반복, 종료일 2025-11-24로 설정한다.
    - **Act**: 사용자가 일정을 저장한다.
    - **Assert**: 2025-11-03, 11-10, 11-17, 11-24 총 4개의 일정이 생성된다.
  
  - **AC-F03-03: 매월 반복 일정 생성**
    - **Arrange**: 사용자가 2025-11-15 일정을 '매월' 반복, 종료일 2025-12-31로 설정한다.
    - **Act**: 사용자가 일정을 저장한다.
    - **Assert**: 2025-11-15, 12-15 총 2개의 일정이 생성된다.
  
  - **AC-F03-04: 매년 반복 일정 생성**
    - **Arrange**: 사용자가 2024-11-01 일정을 '매년' 반복, 종료일 2025-12-31로 설정한다.
    - **Act**: 사용자가 일정을 저장한다.
    - **Assert**: 2024-11-01, 2025-11-01 총 2개의 일정이 생성된다.

### **[F04] 특수 날짜 반복 처리 - 매월 31일**

31일에 매월 반복 설정 시 31일이 존재하는 달에만 일정을 생성합니다.

- **사용자 시나리오 (User Story)**: 사용자가 31일에 매월 반복 일정을 생성하면 31일이 있는 달에만 일정이 생성된다.

- **인수 기준 (Acceptance Criteria):**
  - **AC-F04-01: 31일 매월 반복 일정 생성**
    - **Arrange**: 사용자가 2025-01-31 일정을 '매월' 반복, 종료일 2025-12-31로 설정한다.
    - **Act**: 사용자가 일정을 저장한다.
    - **Assert**: 2025-01-31, 03-31, 05-31, 07-31, 08-31, 10-31, 12-31 총 7개의 일정만 생성된다. (2월, 4월, 6월, 9월, 11월은 건너뜀)
  
  - **AC-F04-02: 30일 매월 반복 일정 생성**
    - **Arrange**: 사용자가 2025-01-30 일정을 '매월' 반복, 종료일 2025-12-31로 설정한다.
    - **Act**: 사용자가 일정을 저장한다.
    - **Assert**: 2025-01-30, 03-30, 04-30, 05-30, 06-30, 07-30, 08-30, 09-30, 10-30, 11-30, 12-30 총 11개의 일정이 생성된다. (2월만 건너뜀)
  
  - **AC-F04-03: 29일 매월 반복 일정 생성 (평년)**
    - **Arrange**: 사용자가 2025-01-29 일정을 '매월' 반복, 종료일 2025-12-31로 설정한다.
    - **Act**: 사용자가 일정을 저장한다.
    - **Assert**: 2025년은 평년이므로 2월 29일이 없어 2025-01-29, 03-29, 04-29, 05-29, 06-29, 07-29, 08-29, 09-29, 10-29, 11-29, 12-29 총 11개의 일정이 생성된다. (2월만 건너뜀)

### **[F05] 특수 날짜 반복 처리 - 윤년 2월 29일**

2월 29일에 매년 반복 설정 시 윤년에만 일정을 생성합니다.

- **사용자 시나리오 (User Story)**: 사용자가 윤년 2월 29일에 매년 반복 일정을 생성하면 윤년에만 일정이 생성된다.

- **인수 기준 (Acceptance Criteria):**
  - **AC-F05-01: 윤년 2월 29일 매년 반복**
    - **Arrange**: 사용자가 2024-02-29 일정을 '매년' 반복, 종료일 2030-12-31로 설정한다.
    - **Act**: 사용자가 일정을 저장한다.
    - **Assert**: 2024-02-29, 2028-02-29 총 2개의 일정만 생성된다. (2025, 2026, 2027, 2029, 2030년은 평년이므로 건너뜀)
  
  - **AC-F05-02: 일반 날짜 매년 반복**
    - **Arrange**: 사용자가 2024-03-15 일정을 '매년' 반복, 종료일 2027-12-31로 설정한다.
    - **Act**: 사용자가 일정을 저장한다.
    - **Assert**: 2024-03-15, 2025-03-15, 2026-03-15, 2027-03-15 총 4개의 일정이 생성된다.

### **[F06] 반복 일정 시각적 표시**

캘린더 뷰에서 반복 일정을 아이콘으로 구분하여 표시합니다.

- **사용자 시나리오 (User Story)**: 사용자가 캘린더를 볼 때 반복 일정을 일반 일정과 시각적으로 구분할 수 있다.

- **인수 기준 (Acceptance Criteria):**
  - **AC-F06-01: 반복 일정 아이콘 표시**
    - **Arrange**: 반복 일정과 일반 일정이 캘린더에 존재한다.
    - **Act**: 사용자가 캘린더 뷰를 확인한다.
    - **Assert**: 반복 일정에는 🔁 아이콘이 일정 제목 옆에 표시되고, 일반 일정에는 아이콘이 없다.
  
  - **AC-F06-02: 반복 일정에서 단일 일정으로 변경된 경우 아이콘 제거**
    - **Arrange**: 반복 일정 중 하나를 '해당 일정만 수정'으로 변경하여 단일 일정으로 전환했다.
    - **Act**: 사용자가 캘린더 뷰를 확인한다.
    - **Assert**: 해당 일정에서 🔁 아이콘이 사라지고 일반 일정으로 표시된다.

### **[F07] 반복 일정 수정 - 모달 확인**

반복 일정 수정 시 '해당 일정만 수정하시겠어요?' 모달을 표시하여 수정 범위를 선택합니다.

- **사용자 시나리오 (User Story)**: 사용자가 반복 일정을 수정할 때 해당 일정만 수정할지 전체 반복 일정을 수정할지 선택할 수 있다.

- **인수 기준 (Acceptance Criteria):**
  - **AC-F07-01: 반복 일정 수정 모달 표시**
    - **Arrange**: 사용자가 반복 일정 중 하나를 선택한다.
    - **Act**: 사용자가 수정 버튼을 클릭한다.
    - **Assert**: '해당 일정만 수정하시겠어요?'라는 텍스트와 함께 '예', '아니오', '취소' 버튼이 있는 모달이 표시된다.
  
  - **AC-F07-02: '예' 선택 시 단일 일정 수정**
    - **Arrange**: '해당 일정만 수정하시겠어요?' 모달이 표시되어 있다.
    - **Act**: 사용자가 '예' 버튼을 클릭하고 일정 제목을 변경한 후 저장한다.
    - **Assert**: 해당 일정만 수정되고 `repeat.type`이 'none'으로 변경되어 단일 일정이 된다. 🔁 아이콘이 사라진다.
  
  - **AC-F07-03: '아니오' 선택 시 전체 반복 일정 수정**
    - **Arrange**: '해당 일정만 수정하시겠어요?' 모달이 표시되어 있고, 동일한 반복 그룹에 5개의 일정이 있다.
    - **Act**: 사용자가 '아니오' 버튼을 클릭하고 일정 제목을 '회의'에서 '팀 미팅'으로 변경한 후 저장한다.
    - **Assert**: 동일한 반복 그룹에 속한 모든 5개 일정의 제목이 '팀 미팅'으로 변경되고, 반복 설정(`repeat.type`)은 유지된다. 🔁 아이콘도 유지된다.
  
  - **AC-F07-04: '취소' 선택 시 모달 닫기**
    - **Arrange**: '해당 일정만 수정하시겠어요?' 모달이 표시되어 있다.
    - **Act**: 사용자가 '취소' 버튼을 클릭한다.
    - **Assert**: 모달이 닫히고 수정 작업이 취소되며, 일정은 변경되지 않는다.

### **[F08] 반복 일정 삭제 - 모달 확인**

반복 일정 삭제 시 '해당 일정만 삭제하시겠어요?' 모달을 표시하여 삭제 범위를 선택합니다.

- **사용자 시나리오 (User Story)**: 사용자가 반복 일정을 삭제할 때 해당 일정만 삭제할지 전체 반복 일정을 삭제할지 선택할 수 있다.

- **인수 기준 (Acceptance Criteria):**
  - **AC-F08-01: 반복 일정 삭제 모달 표시**
    - **Arrange**: 사용자가 반복 일정 중 하나를 선택한다.
    - **Act**: 사용자가 삭제 버튼을 클릭한다.
    - **Assert**: '해당 일정만 삭제하시겠어요?'라는 텍스트와 함께 '예', '아니오', '취소' 버튼이 있는 모달이 표시된다.
  
  - **AC-F08-02: '예' 선택 시 단일 일정 삭제**
    - **Arrange**: '해당 일정만 삭제하시겠어요?' 모달이 표시되어 있고, 동일한 반복 그룹에 5개의 일정이 있다.
    - **Act**: 사용자가 '예' 버튼을 클릭한다.
    - **Assert**: 해당 일정만 삭제되고 나머지 4개의 반복 일정은 유지된다.
  
  - **AC-F08-03: '아니오' 선택 시 전체 반복 일정 삭제**
    - **Arrange**: '해당 일정만 삭제하시겠어요?' 모달이 표시되어 있고, 동일한 반복 그룹에 5개의 일정이 있다.
    - **Act**: 사용자가 '아니오' 버튼을 클릭한다.
    - **Assert**: 동일한 반복 그룹에 속한 모든 5개 일정이 삭제된다.
  
  - **AC-F08-04: '취소' 선택 시 모달 닫기**
    - **Arrange**: '해당 일정만 삭제하시겠어요?' 모달이 표시되어 있다.
    - **Act**: 사용자가 '취소' 버튼을 클릭한다.
    - **Assert**: 모달이 닫히고 삭제 작업이 취소되며, 일정은 삭제되지 않는다.

### **[F09] 반복 일정 겹침 검사 제외**

반복 일정은 일정 겹침 검사를 수행하지 않습니다.

- **사용자 시나리오 (User Story)**: 사용자가 반복 일정을 생성할 때 기존 일정과의 겹침 여부를 확인하지 않고 저장할 수 있다.

- **인수 기준 (Acceptance Criteria):**
  - **AC-F09-01: 반복 일정 생성 시 겹침 검사 미수행**
    - **Arrange**: 2025-11-01 10:00-11:00에 기존 일정이 있다.
    - **Act**: 사용자가 2025-11-01 10:30-11:30 일정을 '매일' 반복으로 생성한다.
    - **Assert**: 겹침 검사 없이 반복 일정이 정상적으로 생성된다.
  
  - **AC-F09-02: 일반 일정은 겹침 검사 수행**
    - **Arrange**: 2025-11-01 10:00-11:00에 기존 일정이 있다.
    - **Act**: 사용자가 2025-11-01 10:30-11:30 일정을 반복 없이(단일 일정) 생성한다.
    - **Assert**: '일정 겹침 경고'가 표시되고 사용자에게 확인을 요청한다.

## 6. 변경되어야 하는 파일들 (Affected Files)

### 6.1 데이터 모델
- `src/types.ts`: RepeatInfo 인터페이스에 `id` 필드 추가

### 6.2 유틸리티 함수
- `src/utils/recurringEventUtils.ts` (신규 생성): 반복 일정 생성 로직
  - `generateRecurringEvents()`: 반복 일정 배열 생성
  - `isValidMonthlyDate()`: 매월 반복 날짜 유효성 검사
  - `isLeapYear()`: 윤년 검사
  - `generateRepeatId()`: 반복 그룹 ID 생성

### 6.3 커스텀 훅
- `src/hooks/useRecurringEvents.ts`: 반복 일정 관리 로직
  - 반복 일정 생성
  - 반복 일정 수정 (단일/전체)
  - 반복 일정 삭제 (단일/전체)
- `src/hooks/useEventOperations.ts`: 기존 일정 작업 훅 확장
  - 반복 일정 수정/삭제 시 모달 처리 로직 추가

### 6.4 UI 컴포넌트
- `src/App.tsx`: 
  - 반복 일정 입력 UI 활성화
  - 반복 일정 아이콘(🔁) 표시
  - 반복 일정 수정/삭제 모달 추가
- `src/components/RecurringEventModal.tsx` (신규 생성): 수정/삭제 확인 모달 컴포넌트

## 7. 변경되어야 하는 데이터 모델

### 7.1 RepeatInfo 인터페이스 확장

```typescript
export interface RepeatInfo {
  type: RepeatType; // 'none' | 'daily' | 'weekly' | 'monthly' | 'yearly'
  interval: number;
  endDate?: string; // 반복 종료일 (YYYY-MM-DD 형식)
  id?: string; // 반복 일정 시리즈 식별자 (신규)
}
```

**변경 사항:**
- `id` 필드 추가: 동일한 반복 일정 시리즈를 식별하기 위한 고유 ID
  - 타입: `string | undefined`
  - 생성 시점: 반복 일정 최초 생성 시
  - 생성 방법: `crypto.randomUUID()` 또는 타임스탬프 기반 ID
  - 용도: 전체 반복 일정 수정/삭제 시 필터링

### 7.2 Event 인터페이스 (변경 없음)

```typescript
export interface Event extends EventForm {
  id: string;
}
```

**사용 예시:**
```typescript
// 반복 일정 생성 시
const repeatId = crypto.randomUUID();
const events: Event[] = generateRecurringEvents({
  ...eventForm,
  repeat: {
    type: 'weekly',
    interval: 1,
    endDate: '2025-12-31',
    id: repeatId // 모든 반복 일정이 동일한 ID 공유
  }
});

// 전체 반복 일정 수정 시
const updatedEvents = allEvents.map(event => 
  event.repeat.id === targetRepeatId 
    ? { ...event, title: newTitle } 
    : event
);

// 전체 반복 일정 삭제 시
const remainingEvents = allEvents.filter(event => 
  event.repeat.id !== targetRepeatId
);
```

### 7.3 데이터 검증 규칙

**반복 종료일 검증:**
- 최소값: 일정 시작일 이후
- 최대값: 2025-12-31
- 형식: YYYY-MM-DD

**반복 간격 검증:**
- 최소값: 1
- 타입: 양의 정수

**특수 날짜 처리:**
- 매월 31일: 해당 월에 31일이 존재하는지 확인
- 매년 2월 29일: 해당 연도가 윤년인지 확인

## 8. 에러 처리 및 엣지 케이스

### 8.1 데이터 검증 에러

**E01: 종료일이 시작일보다 이전**
- **상황**: 사용자가 반복 종료일을 일정 시작일보다 이전 날짜로 설정
- **처리**: '종료일은 시작일 이후여야 합니다.' 메시지 표시 및 저장 차단

**E02: 종료일이 최대값 초과**
- **상황**: 사용자가 반복 종료일을 2025-12-31 이후로 설정
- **처리**: 날짜 선택기에서 2025-12-31 이후 날짜 비활성화

**E03: 반복 간격이 0 이하**
- **상황**: 사용자가 반복 간격을 0 또는 음수로 입력
- **처리**: '반복 간격은 1 이상이어야 합니다.' 메시지 표시 및 저장 차단

### 8.2 특수 날짜 처리

**E04: 31일 매월 반복 시 2월 건너뛰기**
- **상황**: 1월 31일에 매월 반복 설정
- **처리**: 2월은 자동으로 건너뛰고 3월 31일에 다음 일정 생성

**E05: 윤년 2월 29일 매년 반복 시 평년 건너뛰기**
- **상황**: 2024-02-29에 매년 반복 설정
- **처리**: 2025, 2026, 2027년은 자동으로 건너뛰고 2028-02-29에 다음 일정 생성

### 8.3 UI 인터랙션 에러

**E06: 모달 취소 시 변경 사항 유지 방지**
- **상황**: 사용자가 반복 일정 수정 중 모달에서 '취소' 클릭
- **처리**: 모든 변경 사항을 되돌리고 원래 상태 유지

**E07: 네트워크 에러 시 일정 생성 실패**
- **상황**: 서버 API 호출 중 네트워크 에러 발생
- **처리**: '일정 저장에 실패했습니다. 다시 시도해 주세요.' 메시지 표시 및 재시도 옵션 제공

### 8.4 데이터 무결성

**E08: 반복 그룹 ID 중복 방지**
- **상황**: 동시에 여러 반복 일정 생성 시 ID 충돌 가능성
- **처리**: UUID 또는 타임스탬프 기반 고유 ID 생성으로 충돌 방지

**E09: 반복 일정 수정 후 단일 일정 전환**
- **상황**: 사용자가 '해당 일정만 수정' 선택 후 repeat 정보 유지 여부
- **처리**: `repeat.type`을 'none'으로 변경하고 `repeat.id`를 제거하여 완전한 단일 일정으로 전환
