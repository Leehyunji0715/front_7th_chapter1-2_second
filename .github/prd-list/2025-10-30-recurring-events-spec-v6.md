# 반복 일정 기능 명세서 v6

## 1. 요약 (Summary)

캘린더 일정 관리 애플리케이션에서 사용자가 반복 일정을 생성, 수정, 삭제할 수 있는 기능을 구현합니다. 매일/매주/매월/매년 단위로 반복되는 일정을 특정 날짜(최대 2025-12-31)까지 자동 생성하며, 반복 일정을 '🔁' 아이콘으로 시각적으로 구분하고, 모달 확인 절차를 통해 개별 일정 또는 전체 반복 일정을 선택적으로 수정/삭제할 수 있습니다.

## 2. 배경 (Background)

현재 애플리케이션은 단일 일정만 관리할 수 있어, 매주 반복되는 회의나 매달 반복되는 이벤트를 일일이 수동으로 입력해야 하는 불편함이 있습니다. 사용자들은 정기적으로 발생하는 일정을 효율적으로 관리하고, 필요에 따라 특정 날짜의 반복 일정만 수정하거나 전체 시리즈를 한 번에 수정/삭제할 수 있는 기능을 필요로 합니다.

이 기능은 사용자의 일정 입력 시간을 크게 단축시키고, 반복적인 작업의 오류를 줄이며, 더 나은 일정 관리 경험을 제공합니다.

## 3. 목표 (Goals)

- 일정 생성 및 수정 시 반복 유형(매일, 매주, 매월, 매년)을 선택할 수 있다.
- 반복 일정이 지정된 종료일(최대 2025-12-31)까지 자동으로 생성된다.
- 캘린더 뷰에서 반복 일정을 '🔁' 아이콘으로 구분하여 표시한다.
- 반복 일정 수정 시 '해당 일정만 수정하시겠어요?' 모달로 수정 범위를 선택할 수 있다.
- 반복 일정 삭제 시 '해당 일정만 삭제하시겠어요?' 모달로 삭제 범위를 선택할 수 있다.
- 월의 특정 날짜(예: 31일)에 매월 반복 설정 시 해당 날짜가 존재하는 달에만 일정이 생성된다.
- 윤년의 특정 날짜(2월 29일)에 매년 반복 설정 시 해당 날짜가 존재하는 해에만 일정이 생성된다.
- 반복 일정은 일정 겹침 검사를 수행하지 않는다.

## 4. 목표가 아닌 것 (Non-Goals)

- 반복 일정에 대한 겹침 검사는 수행하지 않는다.
- 복잡한 반복 패턴(예: 매월 첫째 주 월요일, 평일만 등)은 지원하지 않는다.
- 반복 종료 조건으로 '횟수 지정' 옵션은 제공하지 않는다.
- 반복 일정의 예외 처리(특정 날짜만 건너뛰기)는 지원하지 않는다.
- 서버 API를 통한 반복 일정 동기화는 구현하지 않는다.

## 5. 계획 (Plan)

### **[F01] 반복 유형 선택 기능**

일정 생성 또는 수정 시 사용자가 반복 유형을 선택할 수 있는 UI를 제공합니다.

- **사용자 시나리오 (User Story)**: 사용자가 일정을 생성하거나 수정할 때 반복 유형(매일, 매주, 매월, 매년)을 선택할 수 있다.

- **인수 기준 (Acceptance Criteria):**

  - **AC-F01-01: 반복 유형 선택 UI 표시**

    - **Arrange**: 사용자가 일정 추가/수정 모달을 연다.
    - **Act**: 사용자가 반복 유형 드롭다운을 클릭한다.
    - **Assert**: 드롭다운에서 '매일', '매주', '매월', '매년' 옵션이 표시된다.

  - **AC-F01-02: 매일 반복 선택**

    - **Arrange**: 일정 추가/수정 모달이 열려 있다.
    - **Act**: 사용자가 반복 유형으로 '매일'을 선택한다.
    - **Assert**: `repeat.type`이 'daily'로 설정된다.

  - **AC-F01-03: 매주 반복 선택**

    - **Arrange**: 일정 추가/수정 모달이 열려 있다.
    - **Act**: 사용자가 반복 유형으로 '매주'를 선택한다.
    - **Assert**: `repeat.type`이 'weekly'로 설정된다.

  - **AC-F01-04: 매월 반복 선택**

    - **Arrange**: 일정 추가/수정 모달이 열려 있다.
    - **Act**: 사용자가 반복 유형으로 '매월'을 선택한다.
    - **Assert**: `repeat.type`이 'monthly'로 설정된다.

  - **AC-F01-05: 매년 반복 선택**

    - **Arrange**: 일정 추가/수정 모달이 열려 있다.
    - **Act**: 사용자가 반복 유형으로 '매년'을 선택한다.
    - **Assert**: `repeat.type`이 'yearly'로 설정된다.

### **[F02] 반복 종료 조건 설정**

반복 일정의 종료 날짜를 지정할 수 있는 기능을 제공합니다.

- **사용자 시나리오 (User Story)**: 사용자가 반복 일정의 종료 날짜를 지정할 수 있으며, 최대 2025-12-31까지 설정할 수 있다.

- **인수 기준 (Acceptance Criteria):**

  - **AC-F02-01: 반복 종료일 입력 필드 표시**

    - **Arrange**: 사용자가 반복 유형을 선택한다.
    - **Act**: 반복 종료일 입력 필드를 확인한다.
    - **Assert**: 날짜 선택 필드가 활성화되어 있고, 종료일이 표시된다.

  - **AC-F02-02: 종료일 최대값 제한**

    - **Arrange**: 사용자가 반복 종료일 필드를 클릭한다.
    - **Act**: 사용자가 2025-12-31 이후의 날짜를 입력하려고 한다.
    - **Assert**: 2025-12-31까지만 입력 가능하며, 그 이후 날짜는 입력할 수 없다.

  - **AC-F02-03: 종료일이 시작일보다 이전인 경우 검증**

    - **Arrange**: 사용자가 일정 시작일을 2025-11-01로 설정한다.
    - **Act**: 사용자가 반복 종료일을 2025-10-31로 설정하고 저장을 시도한다.
    - **Assert**: '종료일은 시작일 이후여야 합니다.'라는 검증 메시지가 표시되고 저장이 실행되지 않는다.

### **[F03] 반복 일정 자동 생성**

선택한 반복 유형과 종료일에 따라 반복 일정을 자동으로 생성합니다.

- **사용자 시나리오 (User Story)**: 사용자가 반복 설정을 지정하면 시스템이 종료일까지 자동으로 반복 일정을 생성한다.

- **인수 기준 (Acceptance Criteria):**

  - **AC-F03-01: 매일 반복 일정 생성**

    - **Arrange**: 사용자가 2025-11-01 일정을 '매일' 반복으로 설정하고 종료일을 2025-11-07로 지정한다.
    - **Act**: 사용자가 일정을 저장한다.
    - **Assert**: 2025-11-01부터 2025-11-07까지 총 7개의 일정이 생성된다.

  - **AC-F03-02: 매주 반복 일정 생성**

    - **Arrange**: 사용자가 2025-11-01(토요일) 일정을 '매주' 반복으로 설정하고 종료일을 2025-11-29로 지정한다.
    - **Act**: 사용자가 일정을 저장한다.
    - **Assert**: 2025-11-01, 11-08, 11-15, 11-22, 11-29 총 5개의 토요일 일정이 생성된다.

  - **AC-F03-03: 매월 반복 일정 생성 (정상 케이스)**

    - **Arrange**: 사용자가 2025-11-15 일정을 '매월' 반복으로 설정하고 종료일을 2025-12-31로 지정한다.
    - **Act**: 사용자가 일정을 저장한다.
    - **Assert**: 2025-11-15, 12-15 총 2개의 일정이 생성된다.

  - **AC-F03-04: 매월 반복 일정 생성 (31일 Edge Case)**

    - **Arrange**: 사용자가 2025-10-31 일정을 '매월' 반복으로 설정하고 종료일을 2025-12-31로 지정한다.
    - **Act**: 사용자가 일정을 저장한다.
    - **Assert**: 2025-10-31, 12-31 총 2개의 일정이 생성된다. (11월은 30일까지이므로 생성되지 않음)

  - **AC-F03-05: 매년 반복 일정 생성 (정상 케이스)**

    - **Arrange**: 사용자가 2025-11-01 일정을 '매년' 반복으로 설정하고 종료일을 2025-12-31로 지정한다.
    - **Act**: 사용자가 일정을 저장한다.
    - **Assert**: 2025-11-01 일정 1개만 생성된다. (다음 년도는 범위를 벗어남)

  - **AC-F03-06: 매년 반복 일정 생성 (2월 29일 윤년 Edge Case)**

    - **Arrange**: 사용자가 2024-02-29 일정을 '매년' 반복으로 설정하고 종료일을 2025-12-31로 지정한다.
    - **Act**: 사용자가 일정을 저장한다.
    - **Assert**: 2024-02-29 일정만 생성된다. (2025년은 윤년이 아니므로 2월 29일이 없음)

  - **AC-F03-07: 반복 일정 겹침 검사 미수행**

    - **Arrange**: 2025-11-01 10:00-11:00에 이미 일정이 존재한다.
    - **Act**: 사용자가 2025-11-01 10:30-11:30 일정을 '매일' 반복으로 저장한다.
    - **Assert**: 겹침 경고 없이 반복 일정이 정상적으로 생성된다.

### **[F04] 반복 일정 아이콘 표시**

캘린더 뷰에서 반복 일정을 시각적으로 구분하여 표시합니다.

- **사용자 시나리오 (User Story)**: 사용자가 캘린더에서 반복 일정을 '🔁' 아이콘으로 쉽게 식별할 수 있다.

- **인수 기준 (Acceptance Criteria):**

  - **AC-F04-01: 반복 일정 아이콘 표시**

    - **Arrange**: 반복 설정이 있는 일정이 캘린더에 표시된다.
    - **Act**: 사용자가 해당 일정을 확인한다.
    - **Assert**: 일정 제목 옆에 '🔁' 아이콘이 표시된다.

  - **AC-F04-02: 단일 일정 아이콘 미표시**

    - **Arrange**: 반복 설정이 없는 단일 일정이 캘린더에 표시된다.
    - **Act**: 사용자가 해당 일정을 확인한다.
    - **Assert**: '🔁' 아이콘이 표시되지 않는다.

  - **AC-F04-03: 반복에서 단일로 변경된 일정 아이콘 제거**

    - **Arrange**: 반복 일정 중 하나를 수정하여 단일 일정으로 변경한다.
    - **Act**: 사용자가 수정된 일정을 확인한다.
    - **Assert**: 해당 일정에서 '🔁' 아이콘이 제거된다.

### **[F05] 반복 일정 수정 기능**

반복 일정 수정 시 개별 수정 또는 전체 수정을 선택할 수 있는 모달을 제공합니다.

- **사용자 시나리오 (User Story)**: 사용자가 반복 일정을 수정할 때 해당 일정만 수정할지, 전체 반복 일정을 수정할지 선택할 수 있다.

- **인터페이스 및 데이터 정의:**

  ```typescript
  interface EditRecurringEventModalProps {
    open: boolean;
    onSingle: () => void;
    onAll: () => void;
    onCancel: () => void;
  }
  ```

- **인수 기준 (Acceptance Criteria):**

  - **AC-F05-01: 반복 일정 수정 시 모달 표시**

    - **Arrange**: 사용자가 반복 일정의 수정 버튼을 클릭한다.
    - **Act**: 수정 모달이 열린다.
    - **Assert**: '해당 일정만 수정하시겠어요?' 문구와 함께 '예', '아니오', '취소' 버튼이 있는 모달이 표시된다.

  - **AC-F05-02: '예' 선택 시 단일 일정으로 수정**

    - **Arrange**: 반복 일정 수정 모달에서 '예' 버튼이 표시된다.
    - **Act**: 사용자가 '예' 버튼을 클릭하고 일정 내용을 수정한다.
    - **Assert**: 해당 일정만 수정되고, 해당 일정은 단일 일정으로 변경된다(`repeat.type = 'none'`). '🔁' 아이콘이 제거된다.

  - **AC-F05-03: '아니오' 선택 시 전체 반복 일정 수정**

    - **Arrange**: 반복 일정 수정 모달에서 '아니오' 버튼이 표시된다.
    - **Act**: 사용자가 '아니오' 버튼을 클릭하고 일정 내용을 수정한다.
    - **Assert**: 동일한 반복 그룹에 속한 모든 일정이 수정된다. 반복 설정은 유지되며(`repeat.type`은 그대로), '🔁' 아이콘도 유지된다.

  - **AC-F05-04: '취소' 선택 시 모달 닫기**

    - **Arrange**: 반복 일정 수정 모달이 열려 있다.
    - **Act**: 사용자가 '취소' 버튼을 클릭한다.
    - **Assert**: 모달이 닫히고 아무런 변경사항이 적용되지 않는다.

  - **AC-F05-05: 단일 일정 수정 시 모달 미표시**

    - **Arrange**: 사용자가 반복 설정이 없는 단일 일정의 수정 버튼을 클릭한다.
    - **Act**: 수정 모달이 열린다.
    - **Assert**: '해당 일정만 수정하시겠어요?' 모달이 표시되지 않고, 바로 일정 수정 폼이 열린다.

### **[F06] 반복 일정 삭제 기능**

반복 일정 삭제 시 개별 삭제 또는 전체 삭제를 선택할 수 있는 모달을 제공합니다.

- **사용자 시나리오 (User Story)**: 사용자가 반복 일정을 삭제할 때 해당 일정만 삭제할지, 전체 반복 일정을 삭제할지 선택할 수 있다.

- **인터페이스 및 데이터 정의:**

  ```typescript
  interface DeleteRecurringEventModalProps {
    open: boolean;
    onSingle: () => void;
    onAll: () => void;
    onCancel: () => void;
  }
  ```

- **인수 기준 (Acceptance Criteria):**

  - **AC-F06-01: 반복 일정 삭제 시 모달 표시**

    - **Arrange**: 사용자가 반복 일정의 삭제 버튼을 클릭한다.
    - **Act**: 삭제 확인 모달이 열린다.
    - **Assert**: '해당 일정만 삭제하시겠어요?' 문구와 함께 '예', '아니오', '취소' 버튼이 있는 모달이 표시된다.

  - **AC-F06-02: '예' 선택 시 단일 일정만 삭제**

    - **Arrange**: 반복 일정 삭제 모달에서 '예' 버튼이 표시된다.
    - **Act**: 사용자가 '예' 버튼을 클릭한다.
    - **Assert**: 해당 일정만 삭제되고, 같은 반복 그룹의 다른 일정은 유지된다.

  - **AC-F06-03: '아니오' 선택 시 전체 반복 일정 삭제**

    - **Arrange**: 반복 일정 삭제 모달에서 '아니오' 버튼이 표시된다.
    - **Act**: 사용자가 '아니오' 버튼을 클릭한다.
    - **Assert**: 동일한 반복 그룹에 속한 모든 일정이 삭제된다.

  - **AC-F06-04: '취소' 선택 시 모달 닫기**

    - **Arrange**: 반복 일정 삭제 모달이 열려 있다.
    - **Act**: 사용자가 '취소' 버튼을 클릭한다.
    - **Assert**: 모달이 닫히고 아무런 일정도 삭제되지 않는다.

  - **AC-F06-05: 단일 일정 삭제 시 모달 미표시**

    - **Arrange**: 사용자가 반복 설정이 없는 단일 일정의 삭제 버튼을 클릭한다.
    - **Act**: 삭제 확인이 진행된다.
    - **Assert**: '해당 일정만 삭제하시겠어요?' 모달이 표시되지 않고, 바로 일정이 삭제된다.

### **[F07] Edge Case 처리**

특수한 날짜에 대한 반복 일정 생성 시 올바르게 처리합니다.

- **사용자 시나리오 (User Story)**: 시스템이 31일, 2월 29일 등 특수한 날짜의 반복 일정을 정확하게 생성한다.

- **인수 기준 (Acceptance Criteria):**

  - **AC-F07-01: 매월 31일 반복 일정**

    - **Arrange**: 사용자가 1월 31일에 '매월' 반복 일정을 생성하고 종료일을 12월 31일로 설정한다.
    - **Act**: 일정을 저장한다.
    - **Assert**: 1월 31일, 3월 31일, 5월 31일, 7월 31일, 8월 31일, 10월 31일, 12월 31일에만 일정이 생성된다. (2월, 4월, 6월, 9월, 11월은 31일이 없으므로 생성되지 않음)

  - **AC-F07-02: 매월 30일 반복 일정**

    - **Arrange**: 사용자가 1월 30일에 '매월' 반복 일정을 생성하고 종료일을 12월 31일로 설정한다.
    - **Act**: 일정을 저장한다.
    - **Assert**: 2월을 제외한 모든 달(1월, 3월, 4월, 5월, 6월, 7월, 8월, 9월, 10월, 11월, 12월)의 30일에 일정이 생성된다.

  - **AC-F07-03: 윤년 2월 29일 매년 반복 일정**

    - **Arrange**: 윤년 2월 29일에 '매년' 반복 일정을 생성하고 종료일을 여러 년도 후로 설정한다.
    - **Act**: 일정을 저장한다.
    - **Assert**: 윤년인 해의 2월 29일에만 일정이 생성된다. (비윤년은 생성되지 않음)

  - **AC-F07-04: 2월 28일 매월 반복 일정**

    - **Arrange**: 사용자가 2월 28일에 '매월' 반복 일정을 생성하고 종료일을 12월 31일로 설정한다.
    - **Act**: 일정을 저장한다.
    - **Assert**: 모든 달의 28일에 일정이 생성된다.

### **[F08] Error Case 처리**

잘못된 입력이나 상태에 대한 에러 처리를 명확히 합니다.

- **사용자 시나리오 (User Story)**: 시스템이 잘못된 입력에 대해 명확한 오류 메시지를 표시한다.

- **인수 기준 (Acceptance Criteria):**

  - **AC-F08-01: 종료일 없이 반복 설정 시도**

    - **Arrange**: 사용자가 반복 유형을 선택하지만 종료일을 입력하지 않는다.
    - **Act**: 사용자가 일정을 저장하려고 시도한다.
    - **Assert**: '반복 종료일을 입력해주세요.'라는 오류 메시지가 표시되고 저장이 실행되지 않는다.

  - **AC-F08-02: 시작일보다 이른 종료일 입력**

    - **Arrange**: 사용자가 반복 일정을 생성하고 종료일을 시작일보다 이전 날짜로 입력한다.
    - **Act**: 사용자가 일정을 저장하려고 시도한다.
    - **Assert**: '종료일은 시작일 이후여야 합니다.'라는 오류 메시지가 표시되고 저장이 실행되지 않는다.

  - **AC-F08-03: 2025-12-31 이후 종료일 입력**

    - **Arrange**: 사용자가 반복 종료일을 2026-01-01 이후로 입력하려고 시도한다.
    - **Act**: 사용자가 날짜 입력 필드에 값을 입력한다.
    - **Assert**: '종료일은 2025-12-31까지만 설정 가능합니다.'라는 오류 메시지가 표시되거나, 날짜 선택기에서 2025-12-31 이후 날짜가 비활성화된다.

## 6. 변경되어야 하는 파일들 (Affected Files)

### 프론트엔드

- `src/App.tsx`: 반복 일정 수정/삭제 모달 UI 추가
- `src/hooks/useEventForm.ts`: 반복 설정 관련 폼 상태 관리
- `src/hooks/useEventOperations.ts`: 반복 일정 수정/삭제 로직 추가
- `src/hooks/useRecurringEvents.ts`: 반복 일정 생성 및 관리 로직
- `src/utils/eventUtils.ts`: 반복 일정 유틸리티 함수 추가
- `src/utils/dateUtils.ts`: 날짜 관련 유틸리티 함수 (31일, 윤년 처리)

### 백엔드

- `server.js`: 반복 일정 수정/삭제 API 엔드포인트 추가 또는 수정

### 테스트

- `src/__tests__/hooks/useRecurringEvents.spec.ts`: 반복 일정 훅 테스트
- `src/__tests__/unit/easy.dateUtils.spec.ts`: 날짜 유틸리티 함수 테스트
- `src/__tests__/medium.integration.spec.tsx`: 통합 테스트

## 7. 변경되어야 하는 데이터 모델

### Event 타입 확장

```typescript
export type RepeatType = 'none' | 'daily' | 'weekly' | 'monthly' | 'yearly';

export interface RepeatInfo {
  type: RepeatType;
  interval: number; // 반복 간격 (현재는 1로 고정, 향후 확장 가능)
  endDate?: string; // 반복 종료 날짜 (YYYY-MM-DD 형식, 최대 2025-12-31)
  id?: string; // 반복 그룹 식별자 (동일한 반복 시리즈의 일정을 그룹화)
}

export interface EventForm {
  title: string;
  date: string;
  startTime: string;
  endTime: string;
  description: string;
  location: string;
  category: string;
  repeat: RepeatInfo;
  notificationTime: number;
}

export interface Event extends EventForm {
  id: string;
  originalEventId?: string; // 반복 일정 중 개별 수정된 일정의 원본 이벤트 ID
}
```

### 주요 변경사항

1. **RepeatInfo.id**: 동일한 반복 시리즈에 속한 일정들을 그룹화하기 위한 고유 식별자 추가
2. **Event.originalEventId**: 반복 일정 중 개별적으로 수정된 일정이 원래 어떤 반복 그룹에 속했는지 추적

### 반복 일정 데이터 예시

```json
{
  "id": "event-1",
  "title": "주간 회의",
  "date": "2025-11-01",
  "startTime": "10:00",
  "endTime": "11:00",
  "description": "주간 팀 회의",
  "location": "회의실 A",
  "category": "업무",
  "repeat": {
    "type": "weekly",
    "interval": 1,
    "endDate": "2025-12-31",
    "id": "repeat-group-1"
  },
  "notificationTime": 10
}
```

### 개별 수정된 반복 일정 예시

```json
{
  "id": "event-2",
  "title": "주간 회의 (수정됨)",
  "date": "2025-11-08",
  "startTime": "14:00",
  "endTime": "15:00",
  "description": "주간 팀 회의 - 시간 변경",
  "location": "회의실 B",
  "category": "업무",
  "repeat": {
    "type": "none",
    "interval": 1
  },
  "notificationTime": 10,
  "originalEventId": "event-1"
}
```
